import socket
import pyaudio
import numpy as np

# TCP server setup
host = 'localhost'
port = 12345
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind((host, port))
s.listen(1)
conn, addr = s.accept()

# PyAudio setup
p = pyaudio.PyAudio()
stream = p.open(format=pyaudio.paFloat32, channels=1, rate=22050, output=True)

try:
    while True:
        # Receive data
        data = conn.recv(2048)  # Adjust buffer size if needed
        if not data:
            break
        # Convert bytes back to float32 array
        audioData = np.frombuffer(data, dtype=np.float32)
        # Play audio
        stream.write(audioData.tobytes())
finally:
    stream.stop_stream()
    stream.close()
    p.terminate()
    conn.close()
    s.close()
