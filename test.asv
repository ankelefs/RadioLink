
% Modulate signal M-PSK 
M = 4;

% Model speech as random data
data = randi([0 M-1], 1000, 1);
%data = repmat(3,10000,1);

% Barker Code sequence
barkerCode = [1, 1, 1, 1, 1, -1, -1, 1, 1, -1, 1, -1, 1]; % Barker code length 13
barkerCodeMapped = (barkerCode + 1)/2; % Mapping [-1, 1] to [0, 1] for QPSK
barkerCodeMapped2 = barkerCodeMapped+2;
barkerSequence = [barkerCodeMapped, barkerCodeMapped2];

packet = [barkerSequence.'; data];         % Concenate with random data
% M-PSK modulate 
txSig = pskmod(packet, M, pi/M, 'gray'); % input, modulation order, phase offset, symbol order

% PSK modulate barkerSequence used in transmission
barkerSymbols = pskmod(barkerSequence, M, pi/M, 'gray');
detector = comm.PreambleDetector(barkerSymbols.', 'Threshold', 4);
idx = detector(txSig);
dataStartIdx = idx+1;
% Er noe funky greier her, siste dataen er helt lik, men vi mangler 5
% sampler p√• starten
rxSigFrame = txSig(dataStartIdx:end);

symerr(data,rxSigFrame)
